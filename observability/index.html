
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://aceeric.github.io/ociregistry/observability/">
      
      
        <link rel="prev" href="../systemd/">
      
      
        <link rel="next" href="../load-testing/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Observability - Caching Pull-through OCI Distribution Server</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#observability" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Caching Pull-through OCI Distribution Server" class="md-header__button md-logo" aria-label="Caching Pull-through OCI Distribution Server" data-md-component="logo">
      
  <img src="../assets/white-logo-no-background.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Caching Pull-through OCI Distribution Server
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Observability
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aceeric/ociregistry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Caching Pull-through OCI Distribution Server" class="md-nav__button md-logo" aria-label="Caching Pull-through OCI Distribution Server" data-md-component="logo">
      
  <img src="../assets/white-logo-no-background.svg" alt="logo">

    </a>
    Caching Pull-through OCI Distribution Server
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aceeric/ociregistry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-desktop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start (Desktop)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start (Kubernetes)
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuring-the-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring The Server
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../command-line/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Command Line
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loading And Preloading
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pruning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pruning The Image Cache
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../concur-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Concurrency Design
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../airgap-considerations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Airgap Considerations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rest-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Administrative REST API
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../systemd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running as a systemd Service
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metrics-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics Dashboards
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics Dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-runtime-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Go Runtime Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ociregistry-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ociregistry Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to use
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observability-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Observability Components
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dashboards
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-runtime-metrics-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Go Runtime Metrics dashboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ociregistry-metrics-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ociregistry Metrics dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../load-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Load Testing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../test-driver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Driver
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Limitations
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metrics-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metrics Dashboards
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics Dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-runtime-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Go Runtime Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ociregistry-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ociregistry Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to use
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observability-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        Observability Components
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dashboards
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dashboards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#go-runtime-metrics-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Go Runtime Metrics dashboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ociregistry-metrics-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ociregistry Metrics dashboard
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="observability">Observability<a class="headerlink" href="#observability" title="Permanent link">&para;</a></h1>
<p>The <em>Ociregistry</em> server implements <a href="https://prometheus.io/">Prometheus</a> metrics exposition. Metrics are implemented in the <a href="https://github.com/aceeric/ociregistry/tree/main/impl/metrics">metrics</a> package of the server. Two types of Metrics are provided in two <a href="https://grafana.com/">Grafana</a> dashboards, discussed in the following sections.</p>
<h2 id="metrics-dashboards">Metrics Dashboards<a class="headerlink" href="#metrics-dashboards" title="Permanent link">&para;</a></h2>
<h3 id="go-runtime-metrics">Go Runtime Metrics<a class="headerlink" href="#go-runtime-metrics" title="Permanent link">&para;</a></h3>
<p>Go runtime metrics make use of the Go <a href="https://pkg.go.dev/runtime/metrics">runtime/metrics</a> package. The implementation of Go runtime metrics in the server was informed by the following articles, for which the project expresses appreciation:</p>
<ol>
<li><a href="https://docs.dynatrace.com/docs/ingest-from/technology-support/application-software/go/configuration-and-analysis/analyze-go-metrics">Monitor Your Go Process Internal Metrics in Minutes</a> by Gil Adda, CyberArk Engineering</li>
<li><a href="https://www.datadoghq.com/blog/go-memory-metrics/">Go memory metrics demystified</a> by <a href="https://www.datadoghq.com">Datadog</a></li>
</ol>
<p>The Go runtime metrics package consists of a large set of measurements. All the metrics are exposed to Prometheus, but only the subset that seemed most relevant to the server are presented in the project's Go runtime metrics dashboard.</p>
<h3 id="ociregistry-metrics"><em>Ociregistry</em> Metrics<a class="headerlink" href="#ociregistry-metrics" title="Permanent link">&para;</a></h3>
<p>The <em>Ociregistry</em> metrics are a narrower set than the Go Runtime metrics, reflecting the simple nature of the server:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cached Pulls By Namespace</td>
<td>This is a running total of pulls of cached manifests. The dash presents it as a rate. These are bucketed by namespace (e.g. <code>docker.io</code>, <code>quay.io</code>, and so on.</td>
</tr>
<tr>
<td>Upstream Pulls By Namespace</td>
<td>This is a running total of manifest pulls from upstream registries. Also presented as a rate, and bucketed.</td>
</tr>
<tr>
<td>Manifest Pulls Total</td>
<td>Simply the sum of cached and un-cached pulls.</td>
</tr>
<tr>
<td>Blob Pulls</td>
<td>Like manifest pulls, this is the count of blob pulls. Since most manifests contain many blobs, this is expected to be a larger number than the sum of cached and un-cached pulls.</td>
</tr>
<tr>
<td>Blob Bytes On Disk</td>
<td>Total blob bytes on the file system.</td>
</tr>
<tr>
<td>Manifest Bytes On Disk</td>
<td>Total manifest bytes on the file system.</td>
</tr>
<tr>
<td>Cached Manifest Count</td>
<td>Number of manifests in the in-mem cache. Since most images you pull consist of a multi-arch image list manifest, and an os/arch-specific image, this count will always be greater than the number of manifest files on the file system. The goal here is to understand memory footprint.</td>
</tr>
<tr>
<td>Cached Blob Count</td>
<td>Same as cached manifest count. However, since only the blob digest is cached in-mem, and only cached once, this <em>should</em> match the file system blob count.</td>
</tr>
<tr>
<td>V2 Api Endpoint Hits</td>
<td>Total hits against the V2 OCI Distribution Server spec endpoints <em>that are implemented by the server</em>.</td>
</tr>
<tr>
<td>Api Errors</td>
<td>This is the count of ant API call that results in an error. For example, if one client undertakes an image pull and starts requesting the blobs for an image, and another client simultaneously prunes that image and blobs, then the first client may request a blob that is no longer cached. This is handled as an error by the server.</td>
</tr>
</tbody>
</table>
<h2 id="how-to-use">How to use<a class="headerlink" href="#how-to-use" title="Permanent link">&para;</a></h2>
<p>Metrics are disabled in the server by default, and can be enabled for the <code>serve</code> sub-command with either the <code>--metrics</code> command-line arg, or the <code>metrics:</code> key in the config file. E.g.: <code>ociregistry serve --metrics 2112</code>.</p>
<p>Or: <code>ociregistry --config-file mycfg.yaml serve</code>, if <code>mycfg.yaml</code> has:
<div class="highlight"><pre><span></span><code>metrics: 2112
</code></pre></div></p>
<p>Metrics can be exposed on any port, but take note that the <a href="https://github.com/aceeric/ociregistry/tree/main/observability">observability</a> directory of the project has <code>2112</code> hard-coded into the Prometheus scrape configuration so be aware of that when starting the metrics observability components discussed in the next section.</p>
<h2 id="observability-components">Observability Components<a class="headerlink" href="#observability-components" title="Permanent link">&para;</a></h2>
<p>As discussed above, the <strong>observability</strong> directory of the project has the items needed to access the metrics. The main entry point there is the <a href="https://github.com/aceeric/ociregistry/blob/main/observability/start-containers"><code>start-containers</code></a> Bash script.</p>
<p>This script starts Prometheus, scraping on port 2112 on localhost and then starts Grafana, pulling from Prometheus on localhost:9090. At the present moment, the metrics are only available when running the <em>Ociregistry</em> server locally. Primarily they support load testing.</p>
<h2 id="dashboards">Dashboards<a class="headerlink" href="#dashboards" title="Permanent link">&para;</a></h2>
<h3 id="go-runtime-metrics-dashboard">Go Runtime Metrics dashboard<a class="headerlink" href="#go-runtime-metrics-dashboard" title="Permanent link">&para;</a></h3>
<p><img alt="Go Runtime Metrics" src="../assets/grafana-go-runtime.png" /></p>
<p>From top left to right, and then down, the dashboard shows:</p>
<table>
<thead>
<tr>
<th>Row</th>
<th>Left Panel</th>
<th>Right Panel</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Memory</td>
<td>Goroutines and threads</td>
</tr>
<tr>
<td>2</td>
<td>Heap bytes</td>
<td>Heap objects</td>
</tr>
<tr>
<td>3</td>
<td>Garbage collection</td>
<td>Mutex wait</td>
</tr>
<tr>
<td>4</td>
<td>GC cycles</td>
<td>Process memory</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Process memory is distorted by Virtual Mem which may be coming out of the panel after further evaluation.</p>
</blockquote>
<h3 id="ociregistry-metrics-dashboard"><em>Ociregistry</em> Metrics dashboard<a class="headerlink" href="#ociregistry-metrics-dashboard" title="Permanent link">&para;</a></h3>
<p><img alt="OCI Registry Metrics" src="../assets/grafana-ociregistry.png" /></p>
<p>From top left to right, and then down, the dashboard shows:</p>
<table>
<thead>
<tr>
<th>Row</th>
<th>Left Panel</th>
<th>Right Panel</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Manifest pulls</td>
<td>Blob pulls</td>
</tr>
<tr>
<td>2</td>
<td>Cached pulls</td>
<td>Upstream (un-cached) pulls</td>
</tr>
<tr>
<td>3</td>
<td>File system blob and manifest bytes</td>
<td>Cached manifest and blob counts</td>
</tr>
<tr>
<td>4</td>
<td>Total endpoint hits</td>
<td>API errors</td>
</tr>
</tbody>
</table>
<p>There are a couple of things to be aware of regarding manifest statistics:</p>
<ol>
<li>The dashboard counts manifests in the in-memory cache. Most images cached by the server consist of two manifests: a multi-platform <em>image list</em> manifest and an OS+architecture <em>image manifest</em>. Further, when a manifest is cached in memory by tag, it is stored twice: once by tag and once by digest. Because of this the count of cached manifests - being a memory count - will always be higher than the number of manifest files on the file system. The thing to remember is that the dashboard metrics are memory object counters.</li>
<li>The manifest pull rate also reflects the fact that a typical client image pull consists of first an image list manifest pull (by tag), then an image manifest pull (by digest.) Therefore, the stats you see in the dashboard will almost always be higher a client-centric count of image pulls.</li>
</ol>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>In summary, to access the metrics:</p>
<ol>
<li><code>ociregistry serve --metrics 2112</code>.</li>
<li><code>observability/start-containers</code>.</li>
<li>Open Grafana in your browser on http://localhost:3000. (You might have to disable Tracking Protection in Firefox or other browser equivalent.)</li>
<li>Log in with the user/pass in the shell script.</li>
<li>The <em>Ociregistry</em> dashboards are in the <code>Ociregistry</code> folder under <code>Dashboards</code> in the Grafana UI left panel.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../systemd/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Running as a systemd Service">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Running as a systemd Service
              </div>
            </div>
          </a>
        
        
          
          <a href="../load-testing/" class="md-footer__link md-footer__link--next" aria-label="Next: Load Testing">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Load Testing
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.footer", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>