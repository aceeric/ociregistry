#!/usr/bin/env bash
#
# Run from the repo root.
#
# Usage:
#
# scripts/rev-version [from] [to] [optional --update]
#
# E.g.:
#
# scripts/rev-version 1.9.1 1.9.2-prerelease
#

from=$1
to=$2
from=${from//\./\\\.}

if [[ "$#" -eq 2 ]]; then
  sed -e "s/$from/$to/g" ./Makefile
  sed -e "s/$from/$to/g" ./README.md
  sed -e "s/$from/$to/g" ./charts/ociregistry/Chart.yaml
  sed -e "s/$from/$to/g" ./charts/ociregistry/values.yaml
elif [[ "$#" -eq 3 ]] && [[ "$3" == "--update" ]]; then
  sed -i"" -e "s/$from/$to/g" ./Makefile
  sed -i"" -e "s/$from/$to/g" ./README.md
  sed -i"" -e "s/$from/$to/g" ./charts/ociregistry/Chart.yaml
  sed -i"" -e "s/$from/$to/g" ./charts/ociregistry/values.yaml
else
  echo "can't parse args: $@"
  exit 1
fi
